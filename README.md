# pytorch-tree-lstm

This repo contains a Pytorch implementation of the child-sum Tree-LSTM model
([Tai et al. 2015](https://arxiv.org/abs/1503.00075)) implimented with
vectorized tree evaluation and batching.  This module has been tested with
Python 3.6.6, Pytorch 0.4.0-1.0.1.

## Usage

The file `tree_list.py` contains the TreeLSTM module.  For a tree with N nodes,
E edges, and F features, the TreeLSTM module expects tree input in the form of
four tensors:

* `features` - A size N x F tensor containing the features for each node.
* `node_evaluation_order` - A size N tensor containing the order in which
nodes should be evaluated.
* `adjacency_list` - A size E x 2 tensor containing the node indexes of the
features tensor for each pair of connected nodes in the tree.
* `edge_evaluation_order` - A size E tensor containing the order in which edges
should be evaluated.

Example code for generating these arrays given a tree composed of Python dicts
can be found in `convert_tree_to_tensors.py`.

These tensors can be batched together by concatenation (`torch.cat()`) with the
exception of the `adjacency_list`.  The `adjacency_list` contains indexes into
the `features` tensor used to retrieve child features for performing sums over
node children, and when batched together these indexes must be adjusted for the
new position of the features in the batched tensors.  Example code to perform
this offsetting is given in `batch_tensors.py`.

Unbatching the batched tensors can be done via

```python
    torch.split(tensor, tree_sizes, dim=0)
```

Where `tree_sizes` is a list containing the number of nodes in each tree in the
batch.  This function is provided by the `unbatch` function in
`batch_tensors.py` for convenience.  A `tree_sizes` list suitable for this
operation is also generated by the `batch_tensors.batch()` function.
